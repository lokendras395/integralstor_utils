from integralstor_utils import command

def update_date_time(system_date, system_time, system_timezone):
    return_dict={}
    try:
	if system_time == None:
            pass
        else:
            cmd = 'date -s %s' %system_time
            output, err = command.get_command_output(cmd)
            if err:
                raise Exception(err)
            return_dict['time_set'] = True

        if system_date == None:
            pass
        else:
            date_component = system_date.split("/")
            if len(date_component) != 3:
                raise Exception("The input date format is not correct (Ex: MM/DD/YYYY)")
            system_date = '%s-%s-%s' %(date_component[2], date_component[0], date_component[1])
            output_time, err = command.get_command_output("date +%T")
            if err:
                raise Exception(err)
            cmd = 'date -s "%s %s"' %(system_date, output_time[0])
            output, err = command.get_command_output(cmd)
            if err:
                raise Exception(err)
            return_dict['date_set'] = True

        if system_timezone == None:
            pass
        else:
            cmd = 'timedatectl set-timezone %s' % system_timezone
            output, err = command.get_command_output(cmd)
            if err:
                raise Exception(err)
            return_dict['timezone_set'] = True

        cmd = "hwclock -w"
        output, err = command.get_command_output(cmd)
        if err:
            raise Exception(err)
    except Exception, e:
        return None, str(e)
    else:
        return return_dict, None

def get_current_timezone():
    return_dict = {}
    try:
        cmd = "timedatectl | grep 'Time' | grep -oE '(\S+/.+$)'"
        system_timezone, err = command.get_command_output(cmd, shell=True)
        if err:
            raise Exception(err)
        return_dict['system_timezone'] = system_timezone[0]
    except Exception, e:
        return None, str(e)
    else:
        return return_dict, None



#if __name__ == "__main__":
#    output, err = update_date_time("02/02/2020", None)
#    output, err = update_date_time("02/02/2020", "15:15")
#    output, err = update_date_time("02/02/2020". "15:15")    
#    print output
#    print err
